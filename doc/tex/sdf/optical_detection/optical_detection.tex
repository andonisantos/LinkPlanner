\begin{bibunit}[plain]

\clearpage
\section{Optical Detection}

\begin{tcolorbox}	
\begin{tabular}{p{2.75cm} p{0.2cm} p{10.5cm}}
\textbf{Student Name}  &:& Diamantino Silva, (2017-08-18 - ...)\\
\textbf{Goal}          &:& Simulation of various optical detection schemes.\\
\textbf{Directory}     &:& sdf/optical\_detection
\end{tabular}
\end{tcolorbox}
%
\vspace{2em}
%
%++ INVENTADO ++
The detection of light is a fundamental stage in every optical communication system.\\
Every protocol based on the transmission of quantum states depends on the detection system...\\
The transmission of quantum states in quantum protocols depend on this stage, which will allow or\\
%-- PRECISO DE PALEIO MELHOR --
%%
%%
%-- Introducao antiga --
%Quantum noise is an intrinsic property of light, a manifestation of the vaccum field fluctuations
%\cite{fox2006}. %p.132
%Contrarily to the majority of noise sources, that are overcomed by better equipment, quantum noise has a lower bound, given by the Heisenberg uncertanty principle, which cannot be broken. This propertie can be useful in some areas, such in quantum cryptography, were many protocols depend on it to ensure their security.\\
%The objective of this work is to develop a numerical model for the quantum noise in a double homodyne detection and to validate the numerical model with experimental results.\\
%--fim da introducao antiga

%REF:
%https://www.rp-photonics.com/quantum_noise.html

\subsection{Theoretical description}\label{sec:intro}

\subsubsection{Detection}

The detection of an optical signal can be made by a variety of schemes. Each scheme offers a method of measuring 

The detection of light can be performed using a variety of schemes, depending on the property of interest. A series of schemes will be presented and explained by calculating it's response?? and the noise. These calculations will use the semiclassical and quantum models of photodetection.
% PROF: Calculates the signal to noise ratio at the input of the decision circuit for various detection schemes.\\




\subsubsection{Semiclassical versus quantum model}

%++ SHAPIRO1985, p.237 ++\\
%++ EXPLICAR AS ASSUMPÇÕES E APROXIMAÇÕES DESTE MODELO ++\\
%++ Nao falar de fotoes ++\\
%++ (VER O PAPER do FourYearReview\_pub92.pdf) (isto tambem e shapiro)++\\


%inventado:
The semiclassical model assumes that light is a wave, composed by various waves of different frequencies.\\

%++ Esta tudo no mark fox, na pag.90 ++

"(...) The light interacts with the atoms in the detector and liberates individual electrons by the photoelectric effect."
"The probability of the emission of a photoelectron in a short time interval $\Delta t$ is proportional to the intensity $I$, the $A$ iluminated and the time interval $\Delta t$.\\




The interaction between light and matter is the fundamental process in a photodetection???? The used models to describe it uses a quantum mechanical description for matter, for electrons in particular. But the two approaches differ in it's description of light. In the semiclassical description, light is a classical electromagnetic wave (and??).x
In the quantum model light is quantized in energy packets, photons. Each photon will interact with one electron (????)\\
(REF?)\\

Two main approaches are used to describe the process of photodetection, the semiclassical model and the quantum model. In both models, we assume that electrons are quantized (????), but 
\\

"In the semiclassical theory, where the atom is treated quantum-mechanically but the electromagnetic field is treated classically, the phototube has the effect of converting the continuous cycle-averaged classical intensity <I(t)> of the beam into a succession of discrete photocounts."
\footnote{Loundon, p. 117}\\


++ FALAR DO CONCEITO DE FOTAO NA ABORDAGEM QUANTICA ++\\

In the quantum model, light is described a stream of particles - photons.\\
(REF)

Althought the semiclassical model explains the majority of light statistics and effects, in certain conditions (WHICH ARE?), we need a more fundamental explanation based on  the quantum nature of light.\\

"In the quantum photodetection theory, the classsical positive-frequency complex field (...) is replaced by a positive-frequency field operator (...), whose quantum state is specified by a density operator $\rho$. (...)"\\
\cite{shapiro1985quantum} %p.239



++ ACHO QUE SERIA MELHOR INTRODUZIR A NOTAÇÃO COMPLEXA AQUI ++\\



\subsubsection{Single Field Detection}

One of the most simple detection methods is the direct detection of light with a single detector and analysing the resulting photocurrent.
\cite{hans2004} %p.200
%
\begin{figure}[H]
	\label{fig:detection_direct}
	\centering
	\includegraphics{./sdf/optical_detection/figures/detection-direct.pdf}
	\caption{Direct detection.}
\end{figure}


%++ INVENCAO ++
This detection method will only give us the amplitude of the incident field. (REF)\\


%%
%%
%(Quantum noise: Basic measurements and techniques)\\
%(Loundon, p.200)\\
%\\
%(Loundon, p.180)\\
%(Loundon, p.181)\\
%"The electromagnetic field is assumed to excite a single travelling-wave mode with a given wavevector {\bf k} and a polarization direction specified by the label $\lambda$"\\
%\\
%(Loudon, p.35)\\
%(Mark Fox, p.129)\\
%(Mark Fox, p.11)\\
%\\
%(Mark Fox, p.78)\\
%"A light beam which has constant angular frequency $\omega$, phase $\Phi$, and amplitude $\varepsilon_0$(...)"\\
%"The beam emitted by a ideal single-mode laser operating well above thershold is a reasonably good approximation to such a field. The intensity {\em I} of the beam is proportional to the square of the amplitude (eq 2.28) (...)"\\
%Electromagnetic field (real notation)\\ %prof
%\\
%(Hans, p. 13??)\\
%Single Field Detection consists on the detection of a single mode laser beam. This will only measure the instant power of the beam, or in the quantum case, will measure the number of photons per sampling interval.\\
%\footnote{REF?}\\



\noindent
{\bf \em Semiclassical model}\\

% REFERENCIAS:
%\cite{shapiro1985quantum} %p.238

++ TENHO DE TIRAR A LIMPO QUE É O SINAL (A OU E?) E QUE NOMES TEREI QUE DAR ÀS VARIAS CENAS ++\\

Given an electric field generated by an ideal monochromatic single mode laser, it can be modulated in amplitude and phase by a signal $A(t)$ resulting in the function

\begin{equation}
    E_R(t)=\sqrt{2} |A(t)| cos\left(-\omega t + \theta\right) \,\,\,\, \sqrt{W}
\end{equation}
with $A(t)=|A(t)|e^{-i\theta(t)}$.

We will consider that the detector has a bandwidth $B$, greater that the signal $A(t)$, but much smaller than $2 \omega_0$. The calculation of power incident in the photodiode is given by the expected value of the square of the amplitude during a time interval $\Delta t = 2 \pi / \omega$\\
\footnote{REF?}

%PROF
%Measurable optical power, assuming that the detector bandwidth, $B$, is greater than the signal, $A(t)$, bandwidth but much small than $2 \omega_0$

\begin{align}
	P(t)	&= \overline{E_R^2(t)}\nonumber\\
			&= \overline{|A(t)|^2} + \overline{ |A(t)|^2 cos\left(-2 \omega t + 2\theta(t)\right)}\nonumber\\
         &= |A(t)|^2 \,\,\,\, W
\end{align}


\vspace{2em}
\noindent
{\bf \em Complex notation}\\
To simplify calculations, the electric field can be expressed the complex notation
\cite{fox2006} %p.11
%
\begin{equation}
	E(t) = A(t) e^{-i \omega_0 t}
\end{equation}
%
%
The physically measurable quantities are obtained by taking the real part of the complex wave. Using this notation, the beam power, $P(t)$, is obtained by multiplying the electric field's conjugate by itself
\footnote{REF?}
%
\begin{align}
	P(t) &= E^{*}(t) E(t)\nonumber\\
         &= |A(t)|^2
\end{align}
%%
%++ inventado ++
The semiclassical description assumes that the current by a process...
%
% ++ INVENTADO ++
%The photocurrent $i(t)$ is obtained by the removal of electrons from a material which have a bonding energy to the atom's nucleus of $\hbar \omega_0$. Therefore, the photocurrent in function of the optical power ($P(t)$) is expressed as
% -- INVENTADO --
%\footnote{REF?}
%\footnote{Hans, p.180}
%%
\begin{equation}
	i(t) = \eta q \frac{P(t)}{\hbar \omega_0}
\end{equation}
%%
% ++ Nao ha stress com o omega htracado ser um quanta de energia ++\\
in which $\eta$ is the photodiode's responsivity, q is the unit charge and $P(t)/\hbar \omega_0$ is the number of removed electrons. Even though the semiclassical theory of photodetection employs classical fields, it is costumary to recognize in this theory that light of frequency $\omega_0$ is quantized into photons of energy $\hbar \omega_0$, where is Planck's constant.
\cite{shapiro1985quantum} %p.239
\\
The signal is ...
%
\begin{equation}
	E(t) = A(t) e^{-i \omega_0}
\end{equation}
%
Using the definition of electric power of a complex electric field representation, we will get
%
\begin{equation}
	P(t) = |A(t)|^2
	\label{eq:power}
\end{equation}
%
recovering the result of the real representation. The photocurrent can be rewriten as a function of the signal $A(t)$
%
\begin{equation}
	i(t) = \eta q \frac{|A(t)|^2}{\hbar \omega_0}
\end{equation}
%
%++ PORQUE E QUE E NECESSARIO ESTE SEGUNDO MOMENTO? ACHO QUE ESTA RELACIONADO COM A DEFINICAO DE SINAL-RUIDO ++\\
which will use to express the second moment of the photocurrent as
\begin{equation}
	\langle i^2(t) \rangle = \eta^2 q^2 \frac{\langle |A(t)|^4 \rangle }{\hbar^2 \omega_0^2}
\end{equation}
%
Assuming a fase modulation, in which the amplitude is constant, the signal is simplified to
%
\begin{equation}
	A(t) = |A| e^{i \theta}
\end{equation}
%
Therefore, the current becomes constant
%
\begin{equation}
	i(t) = I_0 = \eta q \frac{A_s^2}{\hbar \omega_0}
\end{equation}
%
and it's second moment become simply
%
\begin{equation}
	\langle i^2(t) \rangle = I_0^2
\end{equation}




\vspace{2em}
\noindent
{\bf \em Shot-noise}\\
\\
"Shot noise is related to the statistical fluctuations in both the photocurrent and the dark current."
\footnote{http://qtwork.tudelft.nl/~schouten/linkload/phdiode.pdf, p.4}

(Shot noise in photodiodes)\\
\footnote{Mark Fox, p.94, eq. 5.58}
%%
%"These photon number fluctuations will be refletecd in the photocurrent fluctuations with a fidelity determined by $\eta$. The fluctuations manifest themselves as {\bf noise} in the photocurrent, as illustraded in (...) The time-varying photocurrent i(t) can be broken into time-independent average current <i> and time-varying fluctuations $\Delta i (t)$ according to: $i(t) = <i> + \Delta i(t)$."
%(Mark Fox, p.95)\\
%%
\\
Shot noise is a white noise??? which has a constant power independent of any frequency. Therefore, the variance of current will be proportional to the bandwith...\\
\footnote{REF?}

++ DE ONDE VEM ESTA DEFINICAO DE SHOT NOISE? ++\\
++ PARECE ESTAR RELACIONADA COM O POWER DO SINAL DE ENTRADA (I0) ++\\

\begin{equation}
	\langle i_n^2(t) \rangle = 2 q B I_0
\end{equation}

++ Porque e que se usam segundos momentos? Estamos a assumir que o valor esperado do shot noise seja 0? ++
\\
Using the second moment of the signal (porque?) and the second moment of the quantum noise, we can obtain the signal to noise ratio in function of the signal and bandwidth as 

%Using the and ..., the signal-to-noise ratio is\\
%Therefore, the signal to noise ratio will be proportional to the signal power and ...

\begin{align}
	\frac{S}{N} &= \frac{\langle i^2(t) \rangle}{\langle i_n^2(t) \rangle} \nonumber\\
                &= \frac{I_0}{2 q B}\nonumber\\
                &= \eta \frac{ |A|^2}{\hbar \omega_0 B}
\end{align}




\paragraph{Homodyne Detection}
%%
\begin{figure}[H]
	\centering
	\includegraphics{./sdf/optical_detection/figures/detection-homodyne.pdf}
	\caption{Homodyne detection.}
\end{figure}
%%



{\bf \em Semiclassical model}\\
\\
Given an a splitter with intensity transmission $\epsilon$, the resulting field incident to the photodetector is given by
\cite{shapiro1985} %p.241
\begin{equation}
	E(t) = \sqrt{\epsilon}E_S(t) + \sqrt{1-\epsilon}E_{LO}(t)
\end{equation}

in which $E_{LO} = e^{i \omega_1 t}$ (CONFIRMAR NO SHAPIRO). Given a local oscillator with a much larger power that the signal, the incident power in the photodiode is
\begin{equation}
	P(t) = \eta \left[ (1-\epsilon) P_{LO}(t) + 2 \sqrt{\epsilon (1-\epsilon)} \textrm{Re} \left[ E_S(t) E^\ast_{LO}(t) \right] \right]
\end{equation}

++ inventado ++\\
The uncertanty of this measurement will simply follow the poisson statistics ??, therefore. (ISTO NAO E AQUELE HISTORIA DO VAR(Y) = VAR(Y) + <Y>, POISSON A SEGUIR POISSON). VOU TER DE CRUZAR ESSA HISTORIA DOS DOIS POISSONS NESTA DEDUCAO.\\
-- inventado --\\


++ REFERENCIA: Loundon, p.272 ++\\



{\bf \em Quantum model}\\


\paragraph{Balanced Homodyne Detection}\ \\
%%
\begin{figure}[H]
	\centering
	\includegraphics{./sdf/optical_detection/figures/detection-balanced-homodyne.pdf}
	\caption{Balanced homodyne detection.}
\end{figure}
%%
"In a balanced homodyne detector (BHD), the signal to be measured is mixed with a local oscillator (LO) at a beam splitter. The interference signals from the two output ports of the beam splitter are sent to two photodiodes followed by a subtraction operation, and then, amplification may be applied. The output of a BHD can be made to be proportional to either the amplitude quadrature or the phase quadrature of the input signal depending on the relative phase between the signal and the LO". \footnote{Chi2010, p.2,3, arxiv:1006.1257v2}



{\bf \em Semiclassical model}\\
{\bf \em Quantum model}\\

\paragraph{IQ Homodyne Balanced Detection}\ \\
%%
\begin{figure}[H]
	\centering
	\includegraphics[width=15cm]{./sdf/optical_detection/figures/detection-IQ-balanced-homodyne.pdf}
	\caption{IQ balanced homodyne detection.}
\end{figure}


{\bf \em Semiclassical model}\\
{\bf \em Quantum model}\\


\paragraph{Heterodyne Detection}\ \\
%%
\begin{figure}[H]
	\centering
	\includegraphics{./sdf/optical_detection/figures/detection-heterodyne.pdf}
	\caption{Heterodyne detection.}
\end{figure}

% inventado
In contrast with the homodyne detection, in which the frequency of the signal carrier is equal to the local oscillator, in the heterodyne detection, these frequencies are different.\\
This scheme generalizes the Homodyne detection, in which the frequency of the local oscillator ($\omega_1$) is not necessarilly equal to the frequency of the signal ($\omega_0$).
Because of this, the inference will result in a new signal with an intermediate frequency at...
% PROCURAR REFERENCIAS

{\bf \em Semiclassical model}\\
{\bf \em Quantum model}\\


\paragraph{Balanced Heterodyne Detection}\ \\
%%
\begin{figure}[H]
	\centering
	\includegraphics{./sdf/optical_detection/figures/detection-balanced-heterodyne.pdf}
	\caption{Balanced heterodyne detection.}
\end{figure}


{\bf \em Semiclassical model}\\
{\bf \em Quantum model}\\


\paragraph{IQ Heterodyne Balanced Detection}\ \\


{\bf \em Semiclassical model}\\
{\bf \em Quantum model}\\


-- BEGIN MATHEMATICS --\\
\\
%%
We start by defining number states $\ket{n}$ (or Fock states), which correspond to states with perfectly fixed number of photons
%\footnote{Loundon, p.184}
\cite{loudon2000}.
Associated to those states are two operators, the creation $\hat{a}^\dagger$ and annihilation $\hat{a}$ operators, which in a simple way, remove or add one photon from a given number state
%\footnote{Mark Fox, p.155}
\cite{fox2006}.
Their action is defined as
%
\begin{center}
	\hspace{-4mm}
	\begin{minipage}{44mm}
		\noindent
		\begin{equation}
			\hat{a} \ket{n} = \sqrt{n} \ket{n-1}
		\end{equation}
	\end{minipage}
	$,\quad$
	\begin{minipage}{52mm}
		\noindent
		\begin{equation}
			\hat{a}^\dagger \ket{n} = \sqrt{n+1} \ket{n+1}
		\end{equation}
	\end{minipage}
	$,\quad$
	\begin{minipage}{35mm}
		\noindent
		\begin{equation}
			\hat{n} \ket{n} = n \ket{n}
		\end{equation}
	\end{minipage}
\end{center}
%
in which $\hat{n} = \hat{a}^\dagger\hat{a}$ is the number operator. Therefore, number states are eigenvectors of the number operator.\\
\\
Coherent states have properties that closely resemble classical electromagnetic waves, and are generated by single-mode lasers well above the threshold.
\cite{loudon2000}
%\footnote{Loudon, p.190}
We can defined them, using number states in the following manner
\begin{equation}
\ket{\alpha} = e^{-\frac{|\alpha|^2}{2}} \sum_{n=0}^\infty \frac{\alpha^n}{\sqrt{n!}} \ket{n}
\end{equation}
in which the complex number $\alpha$ is the sole parameter that characterizes it.
%\footnote{Loudon, p.184}
%\footnote{Loudon, p.186}
In fact, if we calculate the expected number of photons with $\bra{\alpha} \hat{n} \ket{\alpha}$ we will obtain $|\alpha|^2$. The coherent state is an eigenstate of the annihilation operator, $\hat{a}\ket{\alpha} = \alpha \ket{\alpha}$.\\
\\
%
%
Using the creation and annihilation operators, we can define two quadrature operators
\cite{loudon2000}
%\footnote{Loudon, p.138, (4.3.36)}
%
\begin{center}
	\begin{minipage}{41mm}
		\noindent
		\begin{equation}
			\hat{X} = \frac{1}{2} \left( \hat{a}^\dagger + \hat{a} \right)
		\end{equation}
	\end{minipage}
	$,\quad$
	\begin{minipage}{40mm}
		\noindent
		\begin{equation}
			\hat{Y} = \frac{i}{2} \left( \hat{a}^\dagger - \hat{a} \right)
		\end{equation}
	\end{minipage}
\end{center}
%
The expected value of these two operators, using a coherent state $\ket{\alpha}$ are
%
\begin{center}
	\begin{minipage}{37mm}
		\noindent
		\begin{equation}
			\braket{\hat{X}} = \textrm{Re}(\alpha)
		\end{equation}
	\end{minipage}
	$,\quad$
	\begin{minipage}{37mm}
		\noindent
		\begin{equation}
			\braket{\hat{Y}} = \textrm{Im}(\alpha)
		\end{equation}
	\end{minipage}
\end{center}
%
We see that the expected value of these operators give us the real and imaginary part of $\alpha$. Now, we can obtain the uncertainty of these operators, using:
%
\begin{equation}
\textrm{Var}(\hat{X}) = \braket{\hat{X}^2} - \braket{\hat{X}}^2
\end{equation}
%
For each of these quadrature operators the variance will be
%
\begin{equation}
\textrm{Var}(\hat{X}) = \textrm{Var}(\hat{Y}) = \frac{1}{4}
\end{equation}
%
This result show us that for both quadratures, the variance of measurement is the same and independent of the value of $\alpha$.
%
%
%
\subsubsection{Homodyne detection}

The measurent of a quadrature of an input signal (S) is made by using the balanced homodyne detection technique, which measures the phase difference between the input signal and a local oscillator (LO). The measurement of quadrature are made relative to a reference phase of the LO, such that if the measurement is made in-phase with this reference, the value will be proportional to the $\hat{X}$ quadrature of the signal. If the phase of the LO is has an offset of $\pi/2$ relative to the reference, the output will be proportional to the $\hat{Y}$ quadrature of the signal.\\
\\
Experimentally, the balanced homodyne detection requires a local oscillator with the same frequency as the input signal, but with a much larger amplitude. These two signals are combined using a 50:50 beam splitter, from were two beams emerge, which are then converted to currents using photodides. Finally, the two currents are subtracted, resulting in an output current proportional to a quadrature of the input signal
\cite{fox2006}.\\
%\footnote{Mark Fox, p. 140}
%
%The balanced homododyne technique is used to measure the phase of the input signal (S), relative to the phase of a local oscillator (LO), which has the same frequency as the input signal, but a much larger amplitude. The technique consists in combining the input signal and the local oscillator, using a 50:50 beam splitter, from whom two beams emerge, which are then converted to currents using photodides. Finally, the two currents are subtracted, resulting in an output current.\\
A phase of the local oscillator can be defined as the reference phase. A phase offset equal to $0$ or $\pi/2$ will give an output proportional to the signal's in-phase component or to the quadrature component, respectively. Therefore, the $\hat{X}$ operator will correspond to the in-phase component and $\hat{Y}$ operator correspond to quadrature component
%\cite{fox2006}.
%\footnote{Mark Fox, p. 140}
\\
%
\begin{figure}[H]
	\label{fig:scheme_homodyne}
	\centering
	\includegraphics{./sdf/optical_detection/figures/scheme_homodyne.pdf}
	\caption{Balanced homodyne detection.}
\end{figure}
%
In the lab and in our simulations, a more complex system is used, the double balanced homodyne detection, which allows the simultaneous measurement of the $\hat{X}$ and $\hat{Y}$ components. The signal is divided in two beam with half the power of the original. One of the beams is used in a balanced homodyne detection with a local oscillator. The other beam is used in another balanced homodyne detection, but using a local oscillator with a phase difference $\pi/2$ relative to the first one.
%
\begin{figure}[H]
	\label{fig:scheme_homodyne}
	\centering
	\includegraphics{./sdf/optical_detection/figures/scheme_double_homodyne.pdf}
	\caption{Balanced double homodyne detection.}
\end{figure}
%
%
%
\subsubsection{Noise sources in homodyne detection}
The detection of light using photodiodes is subjected to various sources of noise. One of these sources is the electrical field itself. The interaction of the signal with the vaccuum field adds quantum noise to the detection.
Another source of noise comes from the detection system, such as photodiodes and other electrical circuits, originating various kinds of noise, such as thermal noise, dark noise and amplifier noise
%\footnote{Hans, p.185}
\cite{hans2004}.
In the following sections, we will focus on two noise sources, quantum noise and thermal noise.
%
%
%
\subsubsection{Quantum Noise}
In order to grasp this effect, the quantum mechanical description of balanced homodyne detection will be used, employing quantum operators to describe the effect of each component in the system (fig. \ref{fig:scheme_homodyne}). We start with the operators $\hat{a}_S$ and $\hat{a}_{LO}$ corresponding to the annihilation operator for the signal and local oscillator, which are the inputs in a beam divisor. The outputs will be $\hat{a}_3$ and $\hat{a}_4$.
Using a balanced beam splitter, we can write the output as
%
\begin{center}
	\begin{minipage}{48mm}
		\noindent
		\begin{equation}
			\hat{a}_3 = \frac{1}{\sqrt{2}} \left( \hat{a}_S + \hat{a}_{LO} \right)
		\end{equation}
	\end{minipage}
	$,\quad$
	\begin{minipage}{48mm}
		\noindent
		\begin{equation}
			\hat{a}_4 = \frac{1}{\sqrt{2}} \left( \hat{a}_S - \hat{a}_{LO} \right)
		\end{equation}
	\end{minipage}
\end{center}
%
The final output of a homodyne measurement will be proportional to the difference between the photocurrents in arm $3$ and $4$. Then
%
\begin{equation}
I_{34} = I_3 - I_4 \sim \braket{\hat{n}_3 - \hat{n}_4}
\end{equation}
%
We can define an operator that describes the difference of number of photons in arm 3 and arm 4:
%
\begin{equation}
\hat{m} = \hat{a}^\dagger_3\hat{a}_3 - \hat{a}^\dagger_4\hat{a}_4
\end{equation}
%
If we assume that the local oscillator produces the the coherent state $\ket{\beta}$, then the expected value of this measurement will be
%
\begin{center}
	\begin{minipage}{58mm}
		\noindent
		\begin{equation}
			\braket{m} = 2|\alpha||\beta|\cos({\theta_\alpha - \theta_\beta})
		\end{equation}
	\end{minipage}
	$,\quad$
	\begin{minipage}{46mm}
		\noindent
		\begin{equation}
			\textrm{Var}(m) = |\alpha|^2 + |\beta|^2
		\end{equation}
	\end{minipage}
\end{center}
%
The local oscillator normally has a greater power than the signal
%VER REFERENCIAS
, then $|\alpha| \ll |\beta|$. If we use as unit, $2|\beta|$, then these two quantities can be simplified to
%
\begin{center}
	\begin{minipage}{52mm}
		\noindent
		\begin{equation}
			\braket{m} = |\alpha|\cos({\theta_\alpha - \theta_\beta})
		\end{equation}
	\end{minipage}
	$,\quad$
	\begin{minipage}{34mm}
		\noindent
		\begin{equation}
			\textrm{Var}(m) \approx \frac{1}{4}
		\end{equation}
	\end{minipage}
\end{center}
%
\cite{hans2004}
%\footnote{Referencia indirecta: Livro: Hans, p.207}
\\
Has we have seen previously, in order to measure two quadratures simultaneously, we can use double balanced homodyne detection. For each quadrature, the input signal now has half the power, so $|\alpha| \rightarrow |\alpha/\sqrt{2}|$.  If we use a local oscillator that produces states $\ket{\beta}$, then we can divide it in two beams in state $\ket{\beta/\sqrt{2}}$ and $\ket{i\beta/\sqrt{2}}$ which will be used in each homodyne detection. In this setting, the expected values for each quadrature, $X$ and $Y$, (in normalized values of $\sqrt{2}|\beta|$) are
%
\begin{center}
	\begin{minipage}{58mm}
		\noindent
		\begin{equation}
			\braket{m_X} = \left|\frac{\alpha}{\sqrt{2}}\right| \cos({\theta_\alpha - \theta_\beta})
		\end{equation}
	\end{minipage}
	$,\quad$
	\begin{minipage}{37mm}
		\noindent
		\begin{equation}
			\textrm{Var}(m_X) \approx \frac{1}{4}
		\end{equation}
	\end{minipage}
\end{center}
%
%
\begin{center}
	\begin{minipage}{58mm}
		\noindent
		\begin{equation}
			\braket{m_Y} =  \left|\frac{\alpha}{\sqrt{2}}\right| \sin({\theta_\alpha - \theta_\beta})
		\end{equation}
	\end{minipage}
	$,\quad$
	\begin{minipage}{37mm}
		\noindent
		\begin{equation}
			\textrm{Var}(m_Y) \approx \frac{1}{4}
		\end{equation}
	\end{minipage}
\end{center}
%
Therefore the measurement of each quadrature will have half the amplitude, but the same variance.
%
%
%
\subsubsection{Thermal noise}
Thermal noise is generated by electrons in response to temperature. It's contribution to the resulting current can be described by the following equation
\cite{fox2006}
%\footnote{Mark Fox, p. 96}
%
\begin{equation}
\braket{(\Delta i_T)^2} = 4 K_B T_0 B/R_L
\end{equation}
%
in which $K_B$ it's Boltzmann's constant, $T_0$ is the absolute temperature, $B$ is the bandwidth and $R_L$ is the receiver load impedance. The $B$ value is imposed by default or chosen when the measurements are made, but the $R_L$ value is dependent in the internal setup of the various components of the detection system. Nevertheless, for simulation purposes, we can just introduce an experimental value.\\
\vspace{1cm}
%
%
\subsection{Simulation setup}

\begin{figure}[H]
\centering
\includegraphics[width=\linewidth]{./sdf/optical_detection/figures/scheme_setup.pdf}
\caption{Overview of the simulated optical system.}
\label{fig:setup}
\end{figure}
%
\vspace{1em}
%
List of signals used in the simulation:
\begin{table}[H]
\centering
\begin{tabular}{|c|l|l|}
\hline
\bf{Signal name}	& \bf{Signal type}						& \bf{Status}\\
\hline
S0					& Binary								& check\\
S1					& OpticalSignal							& check\\
S2					& OpticalSignal							& check\\
S3					& OpticalSignal							& check\\
S4					& OpticalSignal							& check\\
S5					& OpticalSignal							& check\\
S6					& OpticalSignal							& check\\
S7					& TimeContinuousAmplitudeContinuousReal	& check\\
S8					& TimeContinuousAmplitudeContinuousReal	& check\\
S9					& TimeContinuousAmplitudeContinuousReal	& check\\
S10					& TimeContinuousAmplitudeContinuousReal	& check\\
S11					& TimeContinuousAmplitudeContinuousReal	& check\\
S12					& TimeContinuousAmplitudeContinuousReal	& check\\
S13					& TimeContinuousAmplitudeContinuousReal	& check\\
S14					& TimeContinuousAmplitudeContinuousReal	& check\\
S15					& TimeDiscreteAmplitudeContinuousReal	& check\\
S16					& TimeDiscreteAmplitudeContinuousReal	& check\\
S17					& OpticalSignal							& check\\
\hline
\end{tabular}
\end{table}
%
\vspace{2em}
%
This system takes into account the following input parameters:
\begin{table}[H]
\centering
\begin{tabulary}{1.0\textwidth}{|c|p{30mm}|p{70mm}|}
\hline
\textbf{System Parameters}	& {\bf Default value}		& \textbf{Description}\\
\hline
localOscillatorPower1		& $2.0505 \times 10^{-8}$W	& Sets the optical power, in units of W, of the local oscillator inside the MQAM\\
\hline
localOscillatorPower2		& $2.0505 \times 10^{-8}$W	& Sets the optical power, in units of W, of the local oscillator used for Bob's measurements\\
\hline
localOscillatorPhase		& $0$ rad					& Sets the initial phase of the local oscillator used in the detection\\
\hline
responsivity				& $1$ A/W					& Sets the responsivity of the photodiodes used in the homodyne detectors\\
\hline
iqAmplitudeValues			& $\{ \{ 1, 1 \}, \{ -1, 1 \},$ $ \{ -1, -1 \}, \{ 1, -1 \} \}$
														& Sets the amplitude of the states used in the MQAM\\
%
%\hline
%transferMatrix				&
%							$\frac{1}{\sqrt{2}}\{1,1,1,1\}$	
%							& Sets the transfer matrix of the beam splitter used in the homodyne detector\\
%\hline
%shotNoise (FUTURE)      & Chooses if quantum shot noise is used in the simulation\\
%\hline
%thermalNoise (FUTURE)   & Chooses if thermal noise is used in the simulation\\
%\hline
%thermalNoiseAmplitude  (FUTURE)  & Sets the amplitude of the thermal noise\\
%
\hline
\end{tabulary}
\end{table}
%
\vspace{2em}
%
The simulation setup is represented in figure \ref{fig:setup}. The starting point is the MQAM, which generates random states from the constelation given by the variable \texttt{iqAmplitudeValues}. The output from the generator is received in the Optical Hybrid where it is mixed with a local oscillator, outputing two optical signal pairs. Each pair is converted to currents by two photodiodes, and the same currents are subtracted from each other, originating another current proportional to one of the quadratures of the input state.
The other pair suffers the same process, but the resulting subtraction current will be proportional to another quadrature, dephased by $\pi/2$ relative to the other quadrature.\\
%
%\begin{table}[H]
%\centering
%\begin{tabular}{c|c}
%System Blocks                         & netxpto Blocks\\
%\hline
%M - Quadrature Amplitude Modulator    & MQamTransmitter\\
%Local Oscillator                      & LocalOscillator\\
%90deg Optical Hybrid                  & OpticalHybrid\\
%Photodiode                            & Photodiode\\
%Difference Circuit                    & Difference\\
%Sampler                               & Sampler\\
%\end{tabular}
%\end{table}


\subsection*{Required files}\label{Required files}

Header Files
\begin{table}[H]
\centering
\begin{tabulary}{1.0\textwidth}{|L|L|l|}
\hline
\textbf{File}			& \textbf{Description}									& {\bf Status}\\
\hline
netxpto.h               & Generic purpose simulator definitions.				& check\\
\hline
m\_qam\_transmitter.h   & Outputs a QPSK modulated optical signal.				& check\\
\hline
local\_oscillator.h     & Generates continuous coherent signal.					& check\\
\hline
optical\_hybrid.h       & Mixes the two input signals into four outputs.		& check\\
\hline
photodiode.h            & Converts an optical signal to a current.				& check\\
\hline
difference.h            & Ouputs the difference between two input signals.		& check\\
\hline
ideal\_amplifier.h		& Performs a perfect amplification of the input sinal	& check\\
\hline
sampler.h               & Samples the input signal.								& check\\
\hline
real\_to\_complex.h		& Combines two real input signals into a complex signal	& check\\
\hline
sink.h                  & Closes any unused signals.							& check\\
\hline
\end{tabulary}
\end{table}
%
%
Source Files
\begin{table}[H]
\centering
\begin{tabulary}{1.0\textwidth}{|L|L|l|}
\hline
\textbf{File}			& \textbf{Description}									& {\bf Status}\\
\hline
netxpto.cpp				& Generic purpose simulator definitions.				& check\\
\hline
m\_qam\_transmitter.cpp	& Outputs a QPSK modulated optical signal.				& check\\
\hline
local\_oscillator.cpp	& Generates continuous coherent signal.					& check\\
\hline
optical\_hybrid.cpp		& Mixes the two input signals into four outputs.		& check\\
\hline
photodiode.h			& Converts an optical signal to a current.				& check\\
\hline
difference.h			& Ouputs the difference between two input signals.		& check\\
\hline
ideal\_amplifier.h		& Performs a perfect amplification of the input sinal	& check\\
\hline
sampler.cpp				& Samples the input signal.								& check\\
\hline
real\_to\_complex.cpp	& Combines two real input signals into a complex signal	& check\\
\hline
sink.cpp				& Empties the signal buffer.							& check\\
\hline
\end{tabulary}
\end{table}



%\subsection*{Inputs}

%This system takes no inputs.

%\pagebreak
%\subsection*{Outputs}

%The system outputs the following objects:
%\begin{itemize}
%\item Signals:
%\begin{itemize}
%\item Binary Sequence used in the MQAM; (S$_{0}$)
%\item Local Oscillator used in the MQAM; (S$_{1}$)
%\item Local Oscillator used in the detection; (S$_{2}$)
%\item Optical Hybrid Outputs; (S$_{3}$, S$_{4}$, S$_{5}$, S$_{6}$)
%\item In phase Photodiodes output; (S$_{7}$, S$_{8}$)
%\item Quadrature Photodiode output; (S$_{9}$, S$_{10}$)
%\item In phase Difference output; (S$_{11}$)
%\item Quadrature Difference output; (S$_{12}$)
%\item In phase Sampler output; (S$_{13}$)
%\item Quadrature Sampler output; (S$_{14}$)
%\end{itemize}
%\end{itemize}


\pagebreak


\subsection*{Simulation Results}\label{subsec:SHresults}

To test the simulated implementation, a series of states $\{\ket{\phi_i}\}$ were generated and detected, resulting in a series of measurements $\{(x_i,y_i)\}$. The simulation result is presented in figure $\ref{fig:constelation}$:
%
\begin{figure}[H]
\centering
\includegraphics[width=10cm]{./sdf/optical_detection/figures/constelation1.png}
\caption{Simulation of a constelation of 4 states (n = 100)}
\label{fig:constelation}
\end{figure}
%
We see that the measurements made groups in certain regions. Each of this groups is centered in the expected value $(\braket{\textrm{X}}, \braket{\textrm{Y}})$ of one the generated states. Also, they show some variance, which was tested for various expected number of photons, $\braket{n}$, resulting in figure \ref{fig:variance}:
%
\begin{figure}[H]
\captionsetup{justification=centering}
\centering
\includegraphics[width=10cm]{./sdf/optical_detection/figures/plot_var_vs_n1.png}
\caption{Simulation of the variance of $m$.\\Local oscillator expected number of photons: $10^4$}
\label{fig:variance}
\end{figure}
%
It was expected that the variance should independent of the input's signal number of photons. Plot \ref{fig:variance} shows that for low values of $n_S$, the simulation is in accordance with the theoretical prevision, with $\textrm{Var(X)} = \textrm{Var(Y)} = \frac{1}{4}$ . For large values of $n_S$, when the number of photons is about the same has the local oscillator, the quantum noise variance starts to grow proportionally to $n_S$, in accordance with the non approximated calculation of quantum noise (eq. \ref{eq:noise}).\\
\\
{\bf Noise Variance with LO power Simulation}\\
The following plot shows the behavior of current noise variance $\braket{(\Delta i)^2}$ with local oscilator power, $P_{LO}$:
%
%
\begin{figure}[H]
	\centering
	\includegraphics[width=10cm]{./sdf/optical_detection/figures/power_plot.png}
	\caption{Output current variance in function of LO power.}
	\label{fig:variance_lo_power}
\end{figure}
%
%
We see that for low LO power, the dominant noise is the thermal contribution, but for higher power, quantum noise dominates, growing proportionally to $P_{LO}$. This in accordance with equation \ref{eq:approx_noise}\\
\\
\\
%
%
%
%
\subsection{Experimental setup}
%
To confirm the theoretical results obtained in section \ref{subsec:intro}, two experimental setups will be created.\\
In the first experiement, we will study quantum noise in the single homodyne detection. The experimental setup will be based on the paper \ref{chi2011balanced}.\\
In the second experiment, we will study quantum noise in the double homodyne detection setup, which will be basically an extension of the single homodyne detection setup.\\
\\
\subsubsection{Single homodyne detection}
%
To keep the experiment simple and avoid extra sources of noise, we will avoid using black boxes wich have complicated inner workings, having a preference in using simple components, as shown in fig. \ref{fig:experimental_homodyne_setup}:
\\
\begin{figure}[H]
	\centering
	\includegraphics{./sdf/optical_detection/figures/scheme_experimental.pdf}
	\caption{Experimental setup}
	\label{fig:experimental_homodyne_setup}
\end{figure}
%
%
Material list
\begin{table}[H]
	\centering
	\begin{tabulary}{1.0\textwidth}{|L|L|l|}
		\hline
		\textbf{Device}		& \textbf{Description}\\
		\hline
		Local Oscillator	& Yenista OSICS Band C/AG\\
		\hline
		BS					& Beam Splitter\\
		\hline
		Pulse Generator		& HP 8116A Pulse Generator\\
		\hline
		Amplitude Modulator	& Mach Zehnder SDL OC 48\\
		\hline
		VOA					& Eigenlicht Power Meter 420\\
		\hline
		VOA					& Thorlabs VOA 45-APC\\
		\hline
		PIN					& Thorlabs PDB 450C\\
		\hline
		ADC					& Picoscope 6403D\\
		\hline
	\end{tabulary}
\end{table}
%
A single laser is splitted and used as the source for the signal (S) and the local oscillator (LO). The signal beam is pulsed and highly attenuated. The local oscillator is also attenuaded, but not pulsed. The signal and local oscillator interfere in a Beam Splitter originating two beams which are then converted to voltages in the PIN. These voltages are read in the Digital Oscilator (OSC) and collect in the computer. In the post processing phase, the quantum noise is measured by applying a difference between the two beams and measuring it's variance.
\\
The second stage of the experiment will be very similar to the first one, in which the signal and local oscillator branches will be divided. One of the new branches of the local oscilator will suffer a phase delay of $\pi/2$, in order to measure the quadrature component of the incoming signal.\\
%%
%%
\subsection{Thorlabs detector}
%%
The detector used in the laboratory is the Thorlabs PDB 450C. This detector consists of two well-matched photodiodes and a transimpedance amplifier that generates an output voltage (RF OUTPUT) proportional to the difference between the photocurrents of the photodiodes.\\
Additionally, the unit has two monitor outputs(MONITOR+ and MONITOR-) to observe the optical input power level on each photodiode separately.
\footnote{Manual of THORLABS device PBC 450C: https://www.thorlabs.com/\_sd.cfm?fileName=21709-D02.pdf\&partNumber=PDB450C}
%
\begin{figure}[H]
	\centering
	\includegraphics{./sdf/optical_detection/figures/thorlabs-circuit.pdf}
	\caption{Thorlabs PDB 450 detection circuit.}
\end{figure}
%
%
The transimpedance amplifier (TIA) is an opamp-based current to voltage conversion amplifier.
\footnote{http://www.cypress.com/file/131966/download}
It is used in this circuit, given that the photodiode's current has a linear response to incident light in contrast to it's non-linear voltage response.
\footnote{http://www.ti.com/lit/an/sboa035/sboa035.pdf, p.1}
%
Given the several schemes studied in section \ref{sec:schemes}
%
%%
%%
%%++ ITEMS DO PROF ++\\
%- responsividade do pin1 e do pin2
%- ganho do meu amplificar OPAMP
%- largura de banda
%- formado filtro, espectro do filtro
%- ruído térmico, no braço superior, no braço intermédio e no braço inferior
%%
%%
\\
Table of characteristics, listed in the manual:
\begin{table}[H]
	\centering
	\begin{tabulary}{1.0\textwidth}{|L|L|l|}
		\hline
		\textbf{Characteristic}			& \textbf{Value}\\
		\hline
		Bandwidth (monitor)				& DC to 1 MHz\\
		\hline
		Voltage Gain (monitor)			& 10 V/mW @ peak responsivity\\
		\hline
		Voltage Noise (monitor)			& <180 μV (RMS)\\
		\hline
		Max Responsivity (PIN)			& 1.0 A/W\\
		\hline
		RF OUTPUT Bandwidth(-3dB)		& DC to 150 / 45 / 4 / 0.3 / 0.1 MHz\\
		\hline
		RF OUTPUT Transimpedance Gain	& $10^3$ / $10^4$ / $10^5$ / $10^6$ / $10^7$ V/A\\
		\hline
		RF OUTPUT Conversion Gain		& $10^3$ / $10^4$ / $10^5$ / $10^6$ / $10^7$ V/W\\
		\hline
	\end{tabulary}
\end{table}
%%
%%
\noindent
{\bf Gain response}\\
The gain response is obtained by fixing an frequency $\omega_0$ and generating optical signals with various amplitudes $A_i$, such as $V = A_i \sin \left( \omega_0 t \right)$ and reading the output voltage amplitude.
\footnote{REF?}\\
\\
{\bf Frequency response/Bandwidth}\\
The frequency response is obtained by fixing an amplitude $A_0$ and generating  optical signals with various frequencies $\omega_i$, such as $V = A_0 \sin \left( \omega_i t \right)$ and reading the output voltage amplitude.
\footnote{REF?}
\\
The following plot shows the gain for various frequencies???
\begin{figure}[H]
	\centering
	\includegraphics[width=10cm]{./sdf/optical_detection/figures/thorlabs-manual-gain-spec-rf.png}
	\caption{Thorlabs PDB 450 RF output amplitude with frequency, for various gain values.\\(Plots from the manual)}
\end{figure}
%%
%%
\subsubsection{Data analysis}
%
Using the data collected in the Digital Oscilloscope, we process each sample for each power level (which???).
This data analysis will consist in the following steps:
1) Subtract the data coming from MONITOR- from the data from MONITOR+.\\
2) Calculate the average impulse and the variance of the impulse. (VALE A PENA ESPECIFICAR A EQUIVALÊNCIA DE FASE?)\\
3) The representative variance will be the variance of the pulse maximum.\\\
%
For each combination of the expected number of photons present in the signal and the local oscillator, we will obtain the variance in the plateau of the pulse. The final variance is simply the mean of the variances of all pulses.
%

\subsubsection{Double homodyne detection}
%
-- UNDER CONSTRUCTION --\\
\\
The experiemental setup for this experiment is a simple extension of the single homodyne detection. To implement this experiment, the signal beam will be divided in two beams, in which one of them will be detect in phase with local oscillator and the other in phase with a an oscillator with a $pi/2$ phase relative to the first one.????
%

\subsection{Comparative analysis}
%
WARNING -- OLD DATA --\\
\\
Given the theoretical, simulated and experimental frameworks, we will now compare the results given by them.
\\
%
\begin{figure}[H]
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[width=.8\linewidth]{./sdf/optical_detection/figures/noise_exp_channel1.png}
		\caption{$X$ quadrature}
		\label{fig:noise-exp-1}
	\end{subfigure}%
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[width=.8\linewidth]{./sdf/optical_detection/figures/noise_exp_channel3.png}
		\caption{$Y$ quadrature}
		\label{fig:noise-exp-3}
	\end{subfigure}
	\captionsetup{justification=centering}
	\caption{Noise variance dependency with local oscilator power for two different quadratures. Experimental vs fitted data.}
\end{figure}
%
Figures $\ref{fig:noise-exp-1}$ and $\ref{fig:noise-exp-3}$ show measurements of total noise for two different quadratures. For low power of LO, the noise variance flutuates around a constant value. For high power of LO, $(P_{LO}>10^{-4}W)$, the variance of noise shows an increasing trend roughly proportional to $P_{LO}^2$. The polynomial fittings confirm this trend, showing a degree 2 coefficient much larger than the degree 1 coefficient
%
\begin{equation}
\textrm{Var}_X = 2.22 \!\! \times \!\! 10^{-5} + 9.6 \!\! \times \!\! 10^{-3} P_{LO} + 3.40 P_{LO}^2
\end{equation}
\begin{equation}
\textrm{Var}_Y = 2.71 \!\! \times \!\! 10^{-5} + 8.9 \!\! \times \!\! 10^{-3} P_{LO} + 7.25 P_{LO}^2
\end{equation}
%
The expected growth should be proportional to $P_{LO}$, but the RIN noise, originated by the electric apparatus, which grows quadratically with the power, is dominating the noise amplitude for large $P_{LO}$.\\
We see that both the simulation and experimental data display a similar behaviour, but the quadratic growth of noise for large $P_{LO}$ was not predicted in the simulations.\\
%
%
\subsection{Known problems}
%
%
\putbib{./sdf/optical\_detection/optical\_detection}
\end{bibunit}
%\bibliography{./sdf/optical_detection/quantum_noise}
